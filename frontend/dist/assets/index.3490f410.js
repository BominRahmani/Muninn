(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))s(o);new MutationObserver(o=>{for(const a of o)if(a.type==="childList")for(const c of a.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&s(c)}).observe(document,{childList:!0,subtree:!0});function n(o){const a={};return o.integrity&&(a.integrity=o.integrity),o.referrerpolicy&&(a.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?a.credentials="include":o.crossorigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function s(o){if(o.ep)return;o.ep=!0;const a=n(o);fetch(o.href,a)}})();function b(e){return window.go.main.App.LaunchNvimWithNote(e)}function M(e){return window.go.main.App.SaveNote(e)}function $(e){return window.go.main.App.SearchNotes(e)}function H(){window.runtime.Hide()}const d=document.getElementById("capturePopup"),m=document.getElementById("textInput"),f=document.getElementById("attachmentsSection"),v=document.getElementById("fileInput"),N=document.getElementById("pastedIndicator");let l=[];m.addEventListener("input",function(){this.style.height="auto",this.style.height=Math.max(120,this.scrollHeight)+"px"});d.addEventListener("dragover",e=>{e.preventDefault(),d.classList.add("drag-over")});d.addEventListener("dragleave",e=>{d.contains(e.relatedTarget)||d.classList.remove("drag-over")});d.addEventListener("drop",e=>{e.preventDefault(),d.classList.remove("drag-over");const t=Array.from(e.dataTransfer.files);E(t)});document.addEventListener("paste",e=>{const t=e.clipboardData.items,n=[];for(let s of t)s.kind==="file"&&n.push(s.getAsFile());n.length>0&&(E(n),K())});v.addEventListener("change",e=>{const t=Array.from(e.target.files);E(t),v.value=""});function O(){v.click()}function E(e){e.forEach(t=>{const n={id:Date.now()+Math.random(),name:t.name,file:t,type:t.type};l.push(n)}),L()}function F(e){l=l.filter(t=>t.id!==e),L()}function L(){if(l.length===0){f.classList.remove("has-attachments"),f.innerHTML="";return}f.classList.add("has-attachments"),f.innerHTML=l.map(e=>`
        <div class="attachment-item">
            <div class="attachment-icon">${S(e.type)}</div>
            <div class="attachment-name">${e.name}</div>
            <button class="attachment-remove" onclick="removeAttachment(${e.id})">\xD7</button>
        </div>
    `).join("")}function S(e){return e.startsWith("image/")?"IMG":e.includes("pdf")?"PDF":e.includes("text")?"TXT":"FILE"}function K(){N.classList.add("show"),setTimeout(()=>{N.classList.remove("show")},2e3)}async function R(){const e=m.value.trim();if(!e&&l.length===0)return;const t=document.getElementById("capturePopup");t.classList.add("screen-vibrate"),setTimeout(()=>t.classList.remove("screen-vibrate"),300);try{const n=await Promise.all(l.map(async(o,a)=>{let c="",T=null;const u=o.file;if(u.path)c=u.path;else if(u instanceof File||u instanceof Blob){const D=await u.arrayBuffer();T=Array.from(new Uint8Array(D))}return{id:"",fileName:o.name||`attachment_${a}`,fileType:o.type||"application/octet-stream",filePath:c,data:T}})),s={id:crypto.randomUUID(),text:e,attachments:n,timestamp:new Date().toISOString()};await M(s),m.value="",m.style.height="120px",l=[],L(),console.log("Note saved successfully")}catch(n){console.error("Error saving note:",n)}}const y=document.getElementById("search-input"),r=document.getElementById("search-results"),U=document.getElementById("search-overlay");let k,i=-1,x=[],g=!1;y.addEventListener("input",()=>{clearTimeout(k),k=setTimeout(()=>{j(y.value)},150)});y.addEventListener("keydown",e=>{e.key==="ArrowDown"?(e.preventDefault(),C(1)):e.key==="ArrowUp"?(e.preventDefault(),C(-1)):e.key==="Enter"?(e.preventDefault(),W()):e.key==="Escape"&&w()});function C(e){const t=r.querySelectorAll(".search-result-item");t.length!==0&&(i>=0&&i<t.length&&t[i].classList.remove("selected"),i+=e,i<0&&(i=t.length-1),i>=t.length&&(i=0),i>=0&&i<t.length&&(t[i].classList.add("selected"),t[i].scrollIntoView({block:"nearest"})))}function W(){const e=r.querySelectorAll(".search-result-item");i>=0&&i<e.length&&e[i].click()}async function j(e){if(!e.trim()){r.innerHTML="",x=[],i=-1;return}r.innerHTML=`
    <li class="loading-state">
      <div class="loading-icon">\u23F3</div>
      <div class="loading-text">Searching...</div>
    </li>
  `;try{const t=await $(e);if(x=t,r.innerHTML="",i=-1,t.length===0){const n=document.createElement("li");n.className="no-results",n.innerHTML=`
        <div class="no-results-icon">SEARCH</div>
        <div class="no-results-text">No results found</div>
      `,r.appendChild(n);return}t.forEach((n,s)=>{const o=document.createElement("li");o.className="search-result-item",o.innerHTML=`
        <div class="result-icon">\u{1F4DD}</div>
        <div class="result-content">
          <div class="result-text">${X(n.content,e)}</div>
          <div class="result-meta">${P(n.timestamp)} \u2022 ${n.content.length>200?"Long note":"Short note"}</div>
        </div>
      `,o.onclick=()=>{console.log("Selected note:",n.id),A(n)},r.appendChild(o)}),G(t.length,e)}catch(t){console.error("Search failed",t),r.innerHTML=`
      <li class="error-message">
        <div class="error-icon">\u26A0\uFE0F</div>
        <div class="error-text">Search failed</div>
      </li>
    `}}function X(e,t){if(!t)return e;const n=new RegExp(`(${t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")})`,"gi");return e.replace(n,"<mark>$1</mark>")}function P(e){if(!e)return"";const t=new Date(e),s=(new Date-t)/(1e3*60*60);return s<1?"Just now":s<24?`${Math.floor(s)}h ago`:t.toLocaleDateString()}function q(){const e=document.createElement("div");e.className="copy-feedback",e.textContent="Copied to clipboard!",document.body.appendChild(e),setTimeout(()=>{e.remove()},2e3)}function G(e,t){const n=document.querySelector(".search-shortcuts");n&&(e>0?n.innerHTML=`
        <span class="results-count">${e} result${e===1?"":"s"}</span> \u2022 
        <span class="shortcut">\u2318K</span> to search \u2022 
        <span class="shortcut">Click</span> to preview \u2022 
        <span class="shortcut">Backspace</span> to close
      `:n.innerHTML=`
        <span class="shortcut">\u2318K</span> to search \u2022 
        <span class="shortcut">Click</span> to preview \u2022 
        <span class="shortcut">Backspace</span> to close
      `)}function J(){document.getElementById("search-overlay").classList.add("hidden"),document.getElementById("capture-overlay").classList.remove("hidden"),document.getElementById("textInput").focus()}function h(){document.getElementById("capture-overlay").classList.add("hidden"),document.getElementById("search-overlay").classList.remove("hidden"),document.getElementById("search-input").focus()}function w(){document.getElementById("capture-overlay").classList.add("hidden"),document.getElementById("search-overlay").classList.add("hidden"),document.getElementById("note-preview-overlay").classList.add("hidden")}function A(e){document.getElementById("search-overlay").classList.add("hidden");const t=document.getElementById("notePreviewText"),n=document.getElementById("notePreviewAttachments"),s=document.getElementById("notePreviewMeta");t.textContent=e.text||e.content||"";const o=e.timestamp?P(e.timestamp):"",a=(e.text||e.content||"").split(/\s+/).filter(c=>c.length>0).length;s.innerHTML=`
    ${o} \u2022 ${a} word${a===1?"":"s"} \u2022 Note ID: ${e.id} \u2022 
    <span class="shortcut">Enter</span> to edit in nvim \u2022 
    <span class="shortcut">\u2318C</span> to copy \u2022 
    <span class="shortcut">Backspace</span> to return to search
  `,e.attachments&&e.attachments.length>0?n.innerHTML=e.attachments.map(c=>`
      <div class="note-attachment-item">
        <div class="note-attachment-icon">${S(c.fileType||c.type||"")}</div>
        <div class="note-attachment-name">${c.fileName||c.name||"Unknown file"}</div>
      </div>
    `).join(""):n.innerHTML="",document.getElementById("note-preview-overlay").classList.remove("hidden"),g=!0,setTimeout(()=>{g=!1},100)}function p(){document.getElementById("note-preview-overlay").classList.add("hidden")}function I(){const t=document.getElementById("notePreviewText").textContent;navigator.clipboard.writeText(t).then(()=>{q()}).catch(n=>{console.error("Failed to copy note:",n)})}async function B(){const t=document.getElementById("notePreviewText").textContent;try{await b(t),console.log("Launched nvim with note content"),p(),h()}catch(n){console.error("Failed to launch nvim:",n);const s=document.createElement("div");s.className="copy-feedback error",s.textContent="Failed to launch nvim",document.body.appendChild(s),setTimeout(()=>{s.remove()},3e3)}}window.runtime.EventsOn("focusSearch",()=>{h()});window.runtime.EventsOn("focusCapture",()=>{J()});document.addEventListener("keydown",e=>{if(e.key==="Backspace"){if(e.target.tagName==="INPUT"||e.target.tagName==="TEXTAREA"||e.target.isContentEditable)return;const t=document.getElementById("note-preview-overlay"),n=document.getElementById("search-overlay"),s=document.getElementById("capture-overlay");t.classList.contains("hidden")?n.classList.contains("hidden")&&s.classList.contains("hidden")?(e.preventDefault(),console.log("Closing capture popup..."),H()):(e.preventDefault(),w()):(e.preventDefault(),p(),h())}e.ctrlKey&&e.key==="Enter"&&U.classList.contains("hidden")&&(e.preventDefault(),R()),(e.metaKey||e.ctrlKey)&&e.key==="k"&&(e.preventDefault(),h()),(e.metaKey||e.ctrlKey)&&e.key==="c"&&(document.getElementById("note-preview-overlay").classList.contains("hidden")||(e.preventDefault(),I())),e.key==="Enter"&&!document.getElementById("note-preview-overlay").classList.contains("hidden")&&!g&&(e.preventDefault(),B())});window.triggerFileSelect=O;window.removeAttachment=F;window.showNotePreview=A;window.hideNotePreview=p;window.copyNoteToClipboard=I;window.launchNvimWithCurrentNote=B;document.addEventListener("DOMContentLoaded",()=>{const e=document.getElementById("editNvimBtn"),t=document.getElementById("copyNoteBtn"),n=document.getElementById("closeNoteBtn");e&&e.addEventListener("click",B),t&&t.addEventListener("click",I),n&&n.addEventListener("click",()=>{p(),h()})});setTimeout(()=>m.focus(),100);
