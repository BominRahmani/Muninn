(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))a(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const d of o.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&a(d)}).observe(document,{childList:!0,subtree:!0});function n(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerpolicy&&(o.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?o.credentials="include":s.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function a(s){if(s.ep)return;s.ep=!0;const o=n(s);fetch(s.href,o)}})();function x(e){return window.go.main.App.SaveNote(e)}function A(e){return window.go.main.App.SearchNotes(e)}function b(){window.runtime.Hide()}const l=document.getElementById("capturePopup"),m=document.getElementById("textInput"),f=document.getElementById("attachmentsSection"),h=document.getElementById("fileInput"),E=document.getElementById("pastedIndicator");let c=[];m.addEventListener("input",function(){this.style.height="auto",this.style.height=Math.max(120,this.scrollHeight)+"px"});l.addEventListener("dragover",e=>{e.preventDefault(),l.classList.add("drag-over")});l.addEventListener("dragleave",e=>{l.contains(e.relatedTarget)||l.classList.remove("drag-over")});l.addEventListener("drop",e=>{e.preventDefault(),l.classList.remove("drag-over");const t=Array.from(e.dataTransfer.files);v(t)});document.addEventListener("paste",e=>{const t=e.clipboardData.items,n=[];for(let a of t)a.kind==="file"&&n.push(a.getAsFile());n.length>0&&(v(n),N())});h.addEventListener("change",e=>{const t=Array.from(e.target.files);v(t),h.value=""});function D(){h.click()}function v(e){e.forEach(t=>{const n={id:Date.now()+Math.random(),name:t.name,file:t,type:t.type};c.push(n)}),g()}function H(e){c=c.filter(t=>t.id!==e),g()}function g(){if(c.length===0){f.classList.remove("has-attachments"),f.innerHTML="";return}f.classList.add("has-attachments"),f.innerHTML=c.map(e=>`
        <div class="attachment-item">
            <div class="attachment-icon">${M(e.type)}</div>
            <div class="attachment-name">${e.name}</div>
            <button class="attachment-remove" onclick="removeAttachment(${e.id})">\xD7</button>
        </div>
    `).join("")}function M(e){return e.startsWith("image/")?"IMG":e.includes("pdf")?"PDF":e.includes("text")?"TXT":"FILE"}function N(){E.classList.add("show"),setTimeout(()=>{E.classList.remove("show")},2e3)}async function $(){const e=m.value.trim();if(!e&&c.length===0)return;const t=document.getElementById("capturePopup");t.classList.add("screen-vibrate"),setTimeout(()=>t.classList.remove("screen-vibrate"),300);try{const n=await Promise.all(c.map(async(s,o)=>{let d="",L=null;const u=s.file;if(u.path)d=u.path;else if(u instanceof File||u instanceof Blob){const B=await u.arrayBuffer();L=Array.from(new Uint8Array(B))}return{id:"",fileName:s.name||`attachment_${o}`,fileType:s.type||"application/octet-stream",filePath:d,data:L}})),a={id:crypto.randomUUID(),text:e,attachments:n,timestamp:new Date().toISOString()};await x(a),m.value="",m.style.height="120px",c=[],g(),console.log("Note saved successfully")}catch(n){console.error("Error saving note:",n)}}const p=document.getElementById("search-input"),i=document.getElementById("search-results"),w=document.getElementById("search-overlay");let I,r=-1,S=[];p.addEventListener("input",()=>{clearTimeout(I),I=setTimeout(()=>{F(p.value)},150)});p.addEventListener("keydown",e=>{e.key==="ArrowDown"?(e.preventDefault(),T(1)):e.key==="ArrowUp"?(e.preventDefault(),T(-1)):e.key==="Enter"?(e.preventDefault(),C()):e.key==="Escape"&&y()});function T(e){const t=i.querySelectorAll(".search-result-item");t.length!==0&&(r>=0&&r<t.length&&t[r].classList.remove("selected"),r+=e,r<0&&(r=t.length-1),r>=t.length&&(r=0),r>=0&&r<t.length&&(t[r].classList.add("selected"),t[r].scrollIntoView({block:"nearest"})))}function C(){const e=i.querySelectorAll(".search-result-item");r>=0&&r<e.length&&e[r].click()}async function F(e){if(!e.trim()){i.innerHTML="",S=[],r=-1;return}i.innerHTML=`
    <li class="loading-state">
      <div class="loading-icon">\u23F3</div>
      <div class="loading-text">Searching...</div>
    </li>
  `;try{const t=await A(e);if(S=t,i.innerHTML="",r=-1,t.length===0){const n=document.createElement("li");n.className="no-results",n.innerHTML=`
        <div class="no-results-icon">SEARCH</div>
        <div class="no-results-text">No results found</div>
      `,i.appendChild(n);return}t.forEach((n,a)=>{const s=document.createElement("li");s.className="search-result-item",s.innerHTML=`
        <div class="result-icon">\u{1F4DD}</div>
        <div class="result-content">
          <div class="result-text">${O(n.content,e)}</div>
          <div class="result-meta">${P(n.timestamp)} \u2022 ${n.content.length>200?"Long note":"Short note"}</div>
        </div>
      `,s.onclick=()=>{console.log("Selected note:",n.id),navigator.clipboard.writeText(n.text).then(()=>{K()}),y()},i.appendChild(s)}),R(t.length,e)}catch(t){console.error("Search failed",t),i.innerHTML=`
      <li class="error-message">
        <div class="error-icon">\u26A0\uFE0F</div>
        <div class="error-text">Search failed</div>
      </li>
    `}}function O(e,t){if(!t)return e;const n=new RegExp(`(${t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")})`,"gi");return e.replace(n,"<mark>$1</mark>")}function P(e){if(!e)return"";const t=new Date(e),a=(new Date-t)/(1e3*60*60);return a<1?"Just now":a<24?`${Math.floor(a)}h ago`:t.toLocaleDateString()}function K(){const e=document.createElement("div");e.className="copy-feedback",e.textContent="Copied to clipboard!",document.body.appendChild(e),setTimeout(()=>{e.remove()},2e3)}function R(e,t){const n=document.querySelector(".search-shortcuts");n&&(e>0?n.innerHTML=`
        <span class="results-count">${e} result${e===1?"":"s"}</span> \u2022 
        <span class="shortcut">\u2318K</span> to search \u2022 
        <span class="shortcut">\u2318C</span> to copy \u2022 
        <span class="shortcut">Esc</span> to close
      `:n.innerHTML=`
        <span class="shortcut">\u2318K</span> to search \u2022 
        <span class="shortcut">\u2318C</span> to copy \u2022 
        <span class="shortcut">Esc</span> to close
      `)}function U(){document.getElementById("search-overlay").classList.add("hidden"),document.getElementById("capture-overlay").classList.remove("hidden"),document.getElementById("textInput").focus()}function k(){document.getElementById("capture-overlay").classList.add("hidden"),document.getElementById("search-overlay").classList.remove("hidden"),document.getElementById("search-input").focus()}function y(){document.getElementById("capture-overlay").classList.add("hidden"),document.getElementById("search-overlay").classList.add("hidden")}window.runtime.EventsOn("focusSearch",()=>{k()});window.runtime.EventsOn("focusCapture",()=>{U()});document.addEventListener("keydown",e=>{e.key==="Escape"&&(w.classList.contains("hidden")?(console.log("Closing capture popup..."),b()):y()),e.ctrlKey&&e.key==="Enter"&&w.classList.contains("hidden")&&(e.preventDefault(),$()),(e.metaKey||e.ctrlKey)&&e.key==="k"&&(e.preventDefault(),k())});window.triggerFileSelect=D;window.removeAttachment=H;setTimeout(()=>m.focus(),100);
